<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Het Roos spel</title>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
            color: #2d3748;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        h1, h2, h3 {
            color: #4a5568;
            margin-bottom: 20px;
            font-weight: 600;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #4a5568, #6b46c1);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-align: center;
            margin-bottom: 30px;
        }

        button {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(99, 102, 241, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        input, select {
            padding: 12px 16px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            width: 100%;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        input:focus, select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        /* Screen Specific Styles */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .active {
            display: block;
        }

        /* Setup Screen */
        #setup-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .setup-form {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .setup-form label {
            display: block;
            text-align: left;
            margin-bottom: 8px;
            font-weight: 500;
            color: #4a5568;
        }

        /* Card Creation Screen */
        #card-creation-screen {
            text-align: center;
        }

        .player-form {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }

        .player-form:hover {
            transform: translateY(-5px);
        }

        .card-inputs {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Game Screen */
        #game-screen {
            text-align: center;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .game-info {
            display: flex;
            gap: 30px;
            margin-left: 60px; /* Make space for menu button */
        }

        .timer {
            font-size: 2.2rem;
            font-weight: 700;
            color: #6366f1;
            background: rgba(99, 102, 241, 0.1);
            padding: 5px 15px;
            border-radius: 12px;
            min-width: 80px;
        }

        .card-display {
            background: linear-gradient(135deg, #e6e9ef 0%, #ffffff 100%);
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            font-weight: 700;
            margin: 30px 0;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            color: #2d3748;
            text-shadow: 1px 1px 1px rgba(255, 255, 255, 1);
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
        }

        .game-controls button {
            min-width: 150px;
            padding: 15px 30px;
        }

        /* Teams Score */
        .teams-score {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .team-score {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 16px;
            min-width: 180px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .team-score h3 {
            color: #4a5568;
            margin-bottom: 10px;
        }

        .team-score p {
            font-size: 1.2rem;
            font-weight: 600;
            color: #6366f1;
        }

        .active-team {
            transform: scale(1.05);
            border: 2px solid #6366f1;
            background: rgba(99, 102, 241, 0.1);
        }

        /* Results Screen */
        #results-screen {
            text-align: center;
        }

        .results-container {
            background: rgba(255, 255, 255, 0.9);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .winner {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin: 30px 0;
            font-weight: 700;
        }

        .team-results {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 30px;
            margin: 40px 0;
        }

        /* How to Play Screen */
        #how-to-play-screen {
            background: rgba(255, 255, 255, 0.9);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 20px;
        }

        .rules-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }

        .rules-section:last-child {
            border-bottom: none;
        }

        .rules-section h3 {
            color: #6366f1;
            padding-bottom: 10px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .rules-list {
            list-style-position: outside;
            margin-left: 25px;
        }

        .rules-list li {
            margin-bottom: 12px;
            position: relative;
        }

        .rules-list li::marker {
            color: #6366f1;
        }

        /* Utilities */
        .mt-20 {
            margin-top: 20px;
        }

        .text-center {
            text-align: center;
        }

        .round-info {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2);
        }

        .round-description {
            margin-top: 15px;
            font-style: italic;
            background: rgba(99, 102, 241, 0.1);
            color: #4a5568;
            padding: 12px 20px;
            border-radius: 10px;
            display: inline-block;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        /* Round Transition */
        .round-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .round-transition.active {
            opacity: 1;
            pointer-events: all;
        }

        .round-transition-content {
            background: rgba(255, 255, 255, 0.95);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
            animation: scaleIn 0.5s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .round-transition-content h2 {
            font-size: 2.2rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .round-transition-content p {
            font-size: 1.2rem;
            color: #4a5568;
            margin-bottom: 30px;
        }

        .round-transition-content button {
            padding: 15px 40px;
            font-size: 1.2rem;
        }

        /* Player Names Screen */
        #player-names-screen {
            text-align: center;
        }

        .player-name-input {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .player-name-input label {
            width: 40%;
            text-align: right;
            padding-right: 15px;
            font-weight: 500;
            color: #4a5568;
        }

        .player-name-input input {
            flex-grow: 1;
        }

        /* Menu */
        .menu-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 50;
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
            transition: all 0.3s ease;
        }

        .menu-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
        }

        .menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            z-index: 100;
            padding: 100px 20px 20px;
            transition: right 0.3s ease;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(255, 255, 255, 0.2);
        }

        .menu.active {
            right: 0;
        }

        .menu-close {
            position: absolute;
            top: 20px;
            right: 20px;
            cursor: pointer;
            font-size: 1.8rem;
            color: #4a5568;
            transition: all 0.3s ease;
        }

        .menu-close:hover {
            color: #6366f1;
            transform: rotate(90deg);
        }

        .menu-items {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .menu-item {
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #4a5568;
            border: 1px solid transparent;
        }

        .menu-item:hover {
            background-color: rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.2);
            color: #6366f1;
        }

        .turn-indicator {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 15px auto;
            max-width: 300px;
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
            animation: pulse 2s infinite;
            display: none;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4); }
            100% { transform: scale(1); }
        }

        .current-player-highlight {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 6px;
        }

        /* For improved iOS touch feedback */
        button {
            -webkit-tap-highlight-color: transparent;
        }

        /* Additional iOS styling fixes */
        input, select, button {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .game-info {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
                margin-left: 60px;
            }
            
            .game-header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .timer {
                margin-top: 10px;
            }
            
            .teams-score {
                flex-direction: column;
                align-items: center;
            }
            
            .game-controls {
                flex-direction: column;
                gap: 15px;
                align-items: center;
            }
            
            .game-controls button {
                width: 100%;
            }
            
            .card-display {
                height: 250px;
                font-size: 2rem;
            }
        }

        /* Font Loading */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    </style>
</head>
<body>
    <!-- Menu Button and Menu -->
    <div class="menu-button">☰</div>
    <div class="menu">
        <div class="menu-close">✕</div>
        <div class="menu-items">
            <div class="menu-item" data-screen="setup-screen">New Game</div>
            <div class="menu-item" data-screen="how-to-play-screen">How to Play</div>
        </div>
    </div>

    <!-- Setup Screen -->
    <div id="setup-screen" class="screen active">
        <div class="container">
            <h1>Het Roos spel</h1>
            <div class="setup-form">
                <h2>Game Setup</h2>
                <div>
                    <label for="num-players">Number of Players (2-12):</label>
                    <input type="number" id="num-players" min="2" max="12" value="4">
                </div>
                <div>
                    <label for="num-teams">Number of Teams (2-4):</label>
                    <input type="number" id="num-teams" min="2" max="4" value="2">
                </div>
                <button id="start-setup" class="mt-20">Next</button>
                <button id="how-to-play-btn" class="mt-20" style="background-color: #2ecc71;">How to Play</button>
            </div>
        </div>
    </div>

    <!-- How to Play Screen -->
    <div id="how-to-play-screen" class="screen">
        <div class="container">
            <h1>How to Play 30 Seconds Challenge</h1>
            
            <div class="rules-section">
                <h3>Game Overview</h3>
                <p>This is a team-based party game inspired by 30 Seconds, but with a twist! Players create their own cards and compete in 4 different rounds, each with a unique challenge. The goal is to collect as many cards as possible for your team.</p>
            </div>
            
            <div class="rules-section">
                <h3>Setup</h3>
                <ol class="rules-list">
                    <li>Select the number of players (2-12) and teams (2-4).</li>
                    <li>Each player creates 5 cards with one thing on each card (e.g., a person, place, object, concept, etc.).</li>
                    <li>Players are assigned to teams evenly.</li>
                </ol>
            </div>
            
            <div class="rules-section">
                <h3>Gameplay</h3>
                <ol class="rules-list">
                    <li>Teams take turns in 30-second rounds.</li>
                    <li>During a team's turn, one player is the describer and teammates are guessers.</li>
                    <li>A random card is shown to the describer who must help teammates guess what's on the card.</li>
                    <li>If the team guesses correctly, they win the card and a new card appears.</li>
                    <li>The turn continues until the 30-second timer runs out.</li>
                    <li>Teams rotate turns until all cards are won or the round ends.</li>
                </ol>
            </div>
            
            <div class="rules-section">
                <h3>The 4 Rounds</h3>
                <ol class="rules-list">
                    <li><strong>Round 1: Explain</strong> - The describer can use any words (except the word on the card) to explain the card.</li>
                    <li><strong>Round 2: Depict</strong> - The describer must use actions/gestures only (no words) to help teammates guess.</li>
                    <li><strong>Round 3: One Word</strong> - The describer can only use ONE word repeatedly to help teammates guess.</li>
                    <li><strong>Round 4: One Sound</strong> - The describer can only make ONE sound repeatedly (no words) to help teammates guess.</li>
                </ol>
            </div>
            
            <div class="rules-section">
                <h3>Scoring</h3>
                <ul class="rules-list">
                    <li>Each card won is worth 1 point for the team.</li>
                    <li>The team with the most points at the end of all 4 rounds wins the game!</li>
                </ul>
            </div>
            
            <div class="rules-section">
                <h3>Tips</h3>
                <ul class="rules-list">
                    <li>Create cards with a mix of easy and challenging items.</li>
                    <li>When creating cards, think about how they might be guessed using just sounds or gestures.</li>
                </ul>
            </div>
            
            <button id="back-to-setup" class="mt-20">Back to Setup</button>
        </div>
    </div>

    <!-- Player Names Screen -->
    <div id="player-names-screen" class="screen">
        <div class="container">
            <h1>Enter Player Names</h1>
            <p>Now let's add the names for all players.</p>
            
            <div class="setup-form" id="player-names-form">
                <!-- Player name inputs will be added dynamically here -->
            </div>
            
            <button id="confirm-player-names" class="mt-20">Continue to Cards</button>
        </div>
    </div>

    <!-- Card Creation Screen -->
    <div id="card-creation-screen" class="screen">
        <div class="container">
            <h1>Create Your Cards</h1>
            <p>Each player needs to create 5 cards with 1 thing per card.</p>
            
            <div id="player-card-forms"></div>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="screen">
        <div class="container">
            <div class="game-header">
                <div class="game-info">
                    <div class="round-info" id="round-display">Round 1: Explain</div>
                    <div>Team: <span id="current-team">Team 1</span></div>
                    <div>Player: <span id="current-player">Player 1</span></div>
                </div>
                <div class="timer">30</div>
            </div>
            
            <div class="round-description" id="round-description">
                Explain the card using any words except the word on the card
            </div>

            <div class="turn-indicator" id="turn-indicator">
                It's <span id="current-player-name" class="current-player-highlight">Player 1</span>'s turn to describe!
            </div>
            
            <div class="card-display" id="card-display">
                Press Start to begin your turn
            </div>
            
            <div class="teams-score" id="teams-score">
                <!-- Teams score will be added dynamically -->
            </div>
            
            <div class="game-controls">
                <button id="start-turn">Start Turn</button>
                <button id="correct-guess" disabled>Correct</button>
            </div>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="results-screen" class="screen">
        <div class="container">
            <div class="results-container">
                <h1>Game Over!</h1>
                <div class="winner" id="winner-display">Team 1 Wins!</div>
                
                <h2>Final Scores</h2>
                <div class="team-results" id="final-scores">
                    <!-- Final scores will be added dynamically -->
                </div>
                
                <button id="new-game" class="mt-20">New Game</button>
            </div>
        </div>
    </div>

    <!-- Round Transition Screen -->
    <div class="round-transition" id="round-transition">
        <div class="round-transition-content">
            <h2 id="next-round-title">Round 2: Depict</h2>
            <p id="next-round-description">Use gestures only! No words allowed!</p>
            <button id="start-next-round" class="mt-20">Start Round</button>
        </div>
    </div>

    <script>
        // Game state
        const game = {
            players: [],
            teams: [],
            cards: [],
            remainingCards: [],
            currentRound: 1,
            currentTeamIndex: 0,
            currentPlayerIndex: 0,
            timer: null,
            timeLeft: 30,
            roundDescriptions: [
                "Explain the card using any words except the word on the card",
                "Use gestures only! No words allowed!",
                "Use only ONE word repeatedly to help your team guess",
                "Use only ONE sound repeatedly! No words allowed!"
            ],
            roundTitles: [
                "Round 1: Explain",
                "Round 2: Depict",
                "Round 3: One Word",
                "Round 4: One Sound"
            ],
            isPlaying: false
        };

        // DOM Elements
        const setupScreen = document.getElementById('setup-screen');
        const howToPlayScreen = document.getElementById('how-to-play-screen');
        const playerNamesScreen = document.getElementById('player-names-screen');
        const playerNamesForm = document.getElementById('player-names-form');
        const confirmPlayerNamesBtn = document.getElementById('confirm-player-names');
        const cardCreationScreen = document.getElementById('card-creation-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultsScreen = document.getElementById('results-screen');
        const playerCardForms = document.getElementById('player-card-forms');
        const roundDisplay = document.getElementById('round-display');
        const roundDescription = document.getElementById('round-description');
        const currentTeamDisplay = document.getElementById('current-team');
        const currentPlayerDisplay = document.getElementById('current-player');
        const cardDisplay = document.getElementById('card-display');
        const teamsScoreDisplay = document.getElementById('teams-score');
        const timerDisplay = document.querySelector('.timer');
        const winnerDisplay = document.getElementById('winner-display');
        const finalScoresDisplay = document.getElementById('final-scores');
        const roundTransition = document.getElementById('round-transition');
        const nextRoundTitle = document.getElementById('next-round-title');
        const nextRoundDescription = document.getElementById('next-round-description');

        // Buttons
        const startSetupBtn = document.getElementById('start-setup');
        const howToPlayBtn = document.getElementById('how-to-play-btn');
        const backToSetupBtn = document.getElementById('back-to-setup');
        const startGameBtn = document.getElementById('start-game');
        const startTurnBtn = document.getElementById('start-turn');
        const correctGuessBtn = document.getElementById('correct-guess');
        const newGameBtn = document.getElementById('new-game');
        const startNextRoundBtn = document.getElementById('start-next-round');
        const menuButton = document.querySelector('.menu-button');
        const menuClose = document.querySelector('.menu-close');
        const menuItems = document.querySelectorAll('.menu-item');
        const menu = document.querySelector('.menu');

        // Event Listeners
        startSetupBtn.addEventListener('click', validateAndSetupGame);
        howToPlayBtn.addEventListener('click', showHowToPlay);
        confirmPlayerNamesBtn.addEventListener('click', confirmPlayerNames);
        backToSetupBtn.addEventListener('click', backToSetup);
        startTurnBtn.addEventListener('click', startTurn);
        correctGuessBtn.addEventListener('click', handleCorrectGuess);
        newGameBtn.addEventListener('click', resetGame);
        startNextRoundBtn.addEventListener('click', startNextRound);
        menuButton.addEventListener('click', toggleMenu);
        menuClose.addEventListener('click', toggleMenu);
        
        menuItems.forEach(item => {
            item.addEventListener('click', () => {
                const screenId = item.getAttribute('data-screen');
                if (screenId === 'setup-screen') {
                    resetGame();
                } else {
                    showScreen(screenId);
                }
                toggleMenu();
            });
        });

        // Functions
        function toggleMenu() {
            menu.classList.toggle('active');
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showHowToPlay() {
            showScreen('how-to-play-screen');
        }

        function backToSetup() {
            showScreen('setup-screen');
        }

        function validateAndSetupGame() {
            const numPlayers = parseInt(document.getElementById('num-players').value);
            const numTeams = parseInt(document.getElementById('num-teams').value);
            
            if (numPlayers < 2 || numPlayers > 12) {
                alert('Number of players must be between 2 and 12.');
                return;
            }
            
            if (numTeams < 2 || numTeams > 4) {
                alert('Number of teams must be between 2 and 4.');
                return;
            }
            
            if (numPlayers < numTeams) {
                alert('Number of players must be at least equal to number of teams.');
                return;
            }
            
            setupGame(numPlayers, numTeams);
        }

        function setupGame(numPlayers, numTeams) {
            // Clear any previous game data
            game.players = [];
            game.teams = [];
            game.cards = [];
            
            // Store the number of players and teams in game state
            game.numPlayers = numPlayers;
            game.numTeams = numTeams;
            
            // Generate player name inputs
            generatePlayerNameInputs(numPlayers, numTeams);
            
            // Show the player names screen
            showScreen('player-names-screen');
        }

        function generatePlayerNameInputs(numPlayers, numTeams) {
            playerNamesForm.innerHTML = '';
            
            for (let i = 1; i <= numPlayers; i++) {
                const teamId = ((i - 1) % numTeams) + 1;
                
                const inputContainer = document.createElement('div');
                inputContainer.className = 'player-name-input';
                
                inputContainer.innerHTML = `
                    <label for="player-name-${i}">Player ${i} (Team ${teamId}):</label>
                    <input type="text" id="player-name-${i}" value="Player ${i}">
                `;
                
                playerNamesForm.appendChild(inputContainer);
            }
        }

        function confirmPlayerNames() {
            const numPlayers = game.numPlayers;
            const numTeams = game.numTeams;
            
            // Create players with entered names
            for (let i = 1; i <= numPlayers; i++) {
                const playerNameInput = document.getElementById(`player-name-${i}`);
                const playerName = playerNameInput.value.trim() || `Player ${i}`;
                const teamId = ((i - 1) % numTeams) + 1;
                
                game.players.push({
                    id: i,
                    name: playerName,
                    teamId: teamId
                });
            }
            
            // Create teams
            for (let i = 1; i <= numTeams; i++) {
                game.teams.push({
                    id: i,
                    name: `Team ${i}`,
                    score: 0,
                    players: game.players.filter(player => player.teamId === i)
                });
            }
            
            // Continue to card creation
            showNextPlayerCardForm(0);
            showScreen('card-creation-screen');
        }

        function showNextPlayerCardForm(playerIndex) {
            // Clear previous form
            playerCardForms.innerHTML = '';
            
            if (playerIndex >= game.players.length) {
                // All players have created their cards, start the game
                initializeGameScreen();
                showScreen('game-screen');
                return;
            }
            
            const player = game.players[playerIndex];
            
            const playerForm = document.createElement('div');
            playerForm.className = 'player-form';
            playerForm.innerHTML = `
                <h3>${player.name} (Team ${player.teamId})</h3>
                <p>Please create your 5 cards. Other players, look away!</p>
                <div class="card-inputs" id="player-${player.id}-cards">
                    ${Array(5).fill().map((_, i) => `
                        <div>
                            <label for="player-${player.id}-card-${i+1}">Card ${i+1}:</label>
                            <input type="text" id="player-${player.id}-card-${i+1}" placeholder="Enter a person, place, object, etc.">
                        </div>
                    `).join('')}
                </div>
                <button id="save-player-cards" class="mt-20">Save Cards</button>
            `;
            
            playerCardForms.appendChild(playerForm);
            
            // Add event listener to the save button
            document.getElementById('save-player-cards').addEventListener('click', function() {
                if (validatePlayerCards(player)) {
                    // Move to the next player
                    showNextPlayerCardForm(playerIndex + 1);
                }
            });
        }

        function validatePlayerCards(player) {
            let valid = true;
            const cards = [];
            
            for (let i = 1; i <= 5; i++) {
                const cardInput = document.getElementById(`player-${player.id}-card-${i}`);
                const cardText = cardInput.value.trim();
                
                if (cardText === '') {
                    alert(`Please fill out all cards for ${player.name}.`);
                    valid = false;
                    return false;
                }
                
                cards.push({
                    id: game.cards.length + cards.length + 1,
                    text: cardText,
                    createdBy: player.id,
                    ownedBy: null
                });
            }
            
            // Add cards to the game
            game.cards = [...game.cards, ...cards];
            return true;
        }

        function initializeGameScreen() {
            // Reset game state
            game.currentRound = 1;
            // Start with team 0 for first round (already works)
            game.currentTeamIndex = 0;
            game.currentPlayerIndex = 0;
            game.isPlaying = false;
            game.timeLeft = 30;
            
            // Update round display
            roundDisplay.textContent = game.roundTitles[game.currentRound - 1];
            roundDescription.textContent = game.roundDescriptions[game.currentRound - 1];
            
            // Reset team scores
            game.teams.forEach(team => {
                team.score = 0;
            });
            
            // Update current team and player display
            updateTeamAndPlayerDisplay();
            
            // Update teams score display
            updateTeamsScoreDisplay();
            
            // Reset buttons
            startTurnBtn.disabled = false;
            correctGuessBtn.disabled = true;
            
            // Reset card display
            cardDisplay.textContent = 'Press Start to begin your turn';
            
            // Reset timer display
            timerDisplay.textContent = '30';
            
            // Initialize starting team rotation array
            game.remainingCards = [...game.cards];
        }

        function updateTeamAndPlayerDisplay() {
            const currentTeam = game.teams[game.currentTeamIndex];
            const currentPlayer = currentTeam.players[game.currentPlayerIndex];
            
            currentTeamDisplay.textContent = currentTeam.name;
            currentPlayerDisplay.textContent = currentPlayer.name;
            
            // Update the turn indicator
            document.getElementById('current-player-name').textContent = currentPlayer.name;
            
            // Show the turn indicator only when it's not during active play
            const turnIndicator = document.getElementById('turn-indicator');
            if (!game.isPlaying && startTurnBtn.disabled === false) {
                turnIndicator.style.display = 'block';
            } else {
                turnIndicator.style.display = 'none';
            }
        }

        function updateTeamsScoreDisplay() {
            teamsScoreDisplay.innerHTML = '';
            
            game.teams.forEach(team => {
                const teamScoreEl = document.createElement('div');
                teamScoreEl.className = 'team-score';
                if (team.id === game.teams[game.currentTeamIndex].id) {
                    teamScoreEl.classList.add('active-team');
                }
                
                teamScoreEl.innerHTML = `
                    <h3>${team.name}</h3>
                    <p>Score: ${team.score}</p>
                `;
                
                teamsScoreDisplay.appendChild(teamScoreEl);
            });
        }

        function startTurn() {
            if (game.remainingCards.length === 0) {
                if (game.currentRound < 4) {
                    showRoundTransition();
                } else {
                    showResults();
                }
                return;
            }
            
            game.isPlaying = true;
            game.timeLeft = 30;
            
            // Hide turn indicator during play
            document.getElementById('turn-indicator').style.display = 'none';
            
            // Disable start button, enable other buttons
            startTurnBtn.disabled = true;
            correctGuessBtn.disabled = false;
            
            // Show a random card
            showRandomCard();
            
            // Start the timer
            startTimer();
        }

        function showRandomCard() {
            if (game.remainingCards.length === 0) {
                cardDisplay.textContent = 'No more cards left!';
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * game.remainingCards.length);
            const randomCard = game.remainingCards[randomIndex];
            
            cardDisplay.textContent = randomCard.text;
            game.currentCardIndex = randomIndex;
        }

        function startTimer() {
            clearInterval(game.timer);
            
            game.timer = setInterval(() => {
                game.timeLeft--;
                timerDisplay.textContent = game.timeLeft;
                
                if (game.timeLeft <= 0) {
                    endTurn();
                }
            }, 1000);
        }

        function endTurn() {
            clearInterval(game.timer);
            game.isPlaying = false;
            
            // Play timer sound if time ran out
            if (game.timeLeft <= 0) {
                playTimerEndSound();
            }
            
            // Enable start button, disable other buttons
            startTurnBtn.disabled = false;
            correctGuessBtn.disabled = true;
            
            // Reset card display
            cardDisplay.textContent = 'Press Start to begin your turn';
            
            // Move to next team and player
            moveToNextTeamAndPlayer();
            
            // Update displays
            updateTeamAndPlayerDisplay();
            updateTeamsScoreDisplay();
            
            // Show turn indicator
            document.getElementById('turn-indicator').style.display = 'block';
        }

        function moveToNextTeamAndPlayer() {
            game.currentTeamIndex = (game.currentTeamIndex + 1) % game.teams.length;
            
            if (game.currentTeamIndex === 0) {
                game.currentPlayerIndex = (game.currentPlayerIndex + 1) % game.teams[0].players.length;
            }
        }

        function handleCorrectGuess() {
            if (!game.isPlaying) return;
            
            // Award the card to the current team
            const currentTeam = game.teams[game.currentTeamIndex];
            const card = game.remainingCards[game.currentCardIndex];
            
            card.ownedBy = currentTeam.id;
            currentTeam.score++;
            
            // Remove the card from remaining cards
            game.remainingCards.splice(game.currentCardIndex, 1);
            
            // Update displays
            updateTeamsScoreDisplay();
            
            // Show next card or end turn if no cards left
            if (game.remainingCards.length === 0) {
                endTurn();
                
                if (game.currentRound < 4) {
                    showRoundTransition();
                } else {
                    showResults();
                }
                return;
            } else {
                showRandomCard();
            }
        }

        function showRoundTransition() {
            game.currentRound++;
            
            // Reset remaining cards for next round - include ALL cards
            game.remainingCards = [...game.cards];
            
            // Update round transition display
            nextRoundTitle.textContent = game.roundTitles[game.currentRound - 1];
            nextRoundDescription.textContent = game.roundDescriptions[game.currentRound - 1];
            
            // Show round transition
            roundTransition.classList.add('active');
        }

        function startNextRound() {
            // Hide round transition
            roundTransition.classList.remove('active');
            
            // Update round display
            roundDisplay.textContent = game.roundTitles[game.currentRound - 1];
            roundDescription.textContent = game.roundDescriptions[game.currentRound - 1];
            
            // Rotate the starting team for each round but preserve player index
            game.currentTeamIndex = (game.currentRound - 1) % game.teams.length;
            // Don't reset player index: game.currentPlayerIndex = 0;
            
            // Update displays
            updateTeamAndPlayerDisplay();
            updateTeamsScoreDisplay();
        }

        function showResults() {
            // Calculate winner
            let winnerTeam = game.teams[0];
            let isATie = false;
            
            game.teams.forEach(team => {
                if (team.score > winnerTeam.score) {
                    winnerTeam = team;
                    isATie = false;
                } else if (team.score === winnerTeam.score && team.id !== winnerTeam.id) {
                    isATie = true;
                }
            });
            
            // Update winner display
            if (isATie) {
                winnerDisplay.textContent = "It's a Tie!";
            } else {
                winnerDisplay.textContent = `${winnerTeam.name} Wins!`;
            }
            
            // Update final scores display
            finalScoresDisplay.innerHTML = '';
            
            game.teams.forEach(team => {
                const teamScoreEl = document.createElement('div');
                teamScoreEl.className = 'team-score';
                if (team.id === winnerTeam.id && !isATie) {
                    teamScoreEl.classList.add('active-team');
                }
                
                teamScoreEl.innerHTML = `
                    <h3>${team.name}</h3>
                    <p>Score: ${team.score}</p>
                `;
                
                finalScoresDisplay.appendChild(teamScoreEl);
            });
            
            // Show results screen
            showScreen('results-screen');
        }

        function resetGame() {
            // Clear all game data
            game.players = [];
            game.teams = [];
            game.cards = [];
            game.remainingCards = [];
            
            // Clear any running timer
            clearInterval(game.timer);
            
            // Show setup screen
            showScreen('setup-screen');
        }

        // Initialize menu behavior
        function handleOutsideClick(event) {
            // Skip this check for touch events on iOS as we handle them separately
            if (event.type === 'touchend') return;
            
            if (menu.classList.contains('active') && 
                !menu.contains(event.target) && 
                event.target !== menuButton) {
                menu.classList.remove('active');
            }
        }

        function playTimerEndSound() {
            try {
                const context = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(context.destination);
                
                oscillator.type = 'square';
                oscillator.frequency.value = 800;
                gainNode.gain.value = 0.1;
                
                // iOS requires starting the oscillator inside a user interaction event
                oscillator.start(0);
                
                // Beep pattern
                setTimeout(() => { oscillator.frequency.value = 0; }, 200);
                setTimeout(() => { oscillator.frequency.value = 800; }, 400);
                setTimeout(() => { oscillator.frequency.value = 0; }, 600);
                setTimeout(() => { oscillator.frequency.value = 800; }, 800);
                setTimeout(() => { 
                    try {
                        oscillator.stop(); 
                    } catch(e) {
                        console.log('Error stopping oscillator', e);
                    }
                }, 1000);
            } catch (e) {
                console.log('Error playing timer sound', e);
                // Fallback visual notification if sound fails
                timerDisplay.style.color = 'red';
                setTimeout(() => { timerDisplay.style.color = ''; }, 1000);
            }
        }

        function fixiOSButtonClicks() {
            console.log("Applying iOS-specific button click fixes");
            
            // Direct replacement of all button event handlers
            const allButtons = document.querySelectorAll('button');
            allButtons.forEach(button => {
                // Store the original onclick function
                const originalOnClick = button.onclick;
                
                // Remove ALL existing event listeners by cloning the button
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                
                // Add our custom click handler that will work on iOS
                newButton.addEventListener('click', function(event) {
                    console.log("Button clicked:", this.textContent);
                    // Find the corresponding function by ID
                    if (this.id === 'start-setup') validateAndSetupGame();
                    else if (this.id === 'how-to-play-btn') showHowToPlay();
                    else if (this.id === 'back-to-setup') backToSetup();
                    else if (this.id === 'confirm-player-names') confirmPlayerNames();
                    else if (this.id === 'start-turn') startTurn();
                    else if (this.id === 'correct-guess') handleCorrectGuess();
                    else if (this.id === 'new-game') resetGame();
                    else if (this.id === 'start-next-round') startNextRound();
                    else if (this.id === 'save-player-cards') {
                        // This one is dynamic, find the current player
                        const playerIndex = parseInt(this.closest('.player-form').querySelector('h3').textContent.match(/Player (\d+)/)[1]) - 1;
                        const player = game.players[playerIndex];
                        if (validatePlayerCards(player)) {
                            showNextPlayerCardForm(playerIndex + 1);
                        }
                    }
                });
                
                // Add very aggressive touch handlers with direct action
                newButton.addEventListener('touchstart', function(e) {
                    console.log("Touch start on button:", this.id);
                    this.style.backgroundColor = "#4a5568"; // Visual feedback
                    this.style.transform = "scale(0.98)";
                }, { passive: true });
                
                newButton.addEventListener('touchend', function(e) {
                    console.log("Touch end on button:", this.id);
                    this.style.backgroundColor = "";
                    this.style.transform = "";
                    
                    // Instead of trying to simulate a click, directly trigger the action
                    // based on button ID
                    if (this.id === 'start-setup') validateAndSetupGame();
                    else if (this.id === 'how-to-play-btn') showHowToPlay();
                    else if (this.id === 'back-to-setup') backToSetup();
                    else if (this.id === 'confirm-player-names') confirmPlayerNames();
                    else if (this.id === 'start-turn') startTurn();
                    else if (this.id === 'correct-guess') handleCorrectGuess();
                    else if (this.id === 'new-game') resetGame();
                    else if (this.id === 'start-next-round') startNextRound();
                    else if (this.id === 'save-player-cards') {
                        // This one is dynamic, find the current player
                        const playerForm = this.closest('.player-form');
                        if (playerForm) {
                            const playerNameText = playerForm.querySelector('h3').textContent;
                            const playerMatch = playerNameText.match(/(\w+) \(Team \d+\)/);
                            if (playerMatch) {
                                const playerName = playerMatch[1];
                                const player = game.players.find(p => p.name === playerName);
                                if (player && validatePlayerCards(player)) {
                                    const currentIndex = game.players.indexOf(player);
                                    showNextPlayerCardForm(currentIndex + 1);
                                }
                            }
                        }
                    }
                }, { passive: true });
            });
            
            // Fix menu button and menu close button
            document.querySelector('.menu-button').addEventListener('touchend', function(e) {
                e.preventDefault();
                console.log("Menu button touched");
                toggleMenu();
            }, { passive: false });
            
            document.querySelector('.menu-close').addEventListener('touchend', function(e) {
                e.preventDefault();
                console.log("Menu close touched");
                toggleMenu();
            }, { passive: false });
            
            // Fix menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    console.log("Menu item touched:", this.textContent);
                    const screenId = this.getAttribute('data-screen');
                    if (screenId === 'setup-screen') {
                        resetGame();
                    } else {
                        showScreen(screenId);
                    }
                    toggleMenu();
                }, { passive: false });
            });
        }

        document.addEventListener('click', handleOutsideClick);

        // Initialize the game
        document.addEventListener('DOMContentLoaded', () => {
            // Apply iOS detection and fix
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                        (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
            
            if (isIOS) {
                // Apply our aggressive iOS fix
                fixiOSButtonClicks();
                
                // Also add these critical CSS fixes
                const iosCSSFix = document.createElement('style');
                iosCSSFix.textContent = `
                    button, .menu-item, .menu-button, .menu-close {
                        cursor: pointer;
                        -webkit-tap-highlight-color: rgba(0,0,0,0);
                        -webkit-touch-callout: none;
                        -webkit-user-select: none;
                        user-select: none;
                        min-height: 44px;
                        min-width: 44px;
                    }
                    
                    button:active, .menu-item:active, .menu-button:active, .menu-close:active {
                        opacity: 0.8;
                        transform: scale(0.98);
                        background-color: #4a5568;
                    }
                    
                    /* Increase touch targets */
                    .menu-button {
                        padding: 15px;
                        width: 60px;
                        height: 60px;
                    }
                    
                    /* Force hardware acceleration */
                    body * {
                        -webkit-transform: translateZ(0);
                        transform: translateZ(0);
                    }
                `;
                document.head.appendChild(iosCSSFix);
            }
            
            // Set up initial screen
            showScreen('setup-screen');
            
            // Set up event handlers for the "start next round" button
            startNextRoundBtn.addEventListener('click', startNextRound);
        });

        // This adds a modern font from Google Fonts
        const fontLink = document.createElement('link');
        fontLink.rel = 'stylesheet';
        fontLink.href = 'https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap';
        document.head.appendChild(fontLink);

        // Optional: Add subtle animations to game elements
        document.addEventListener('DOMContentLoaded', () => {
            // Add animation to card display on correct guess
            const correctGuessBtn = document.getElementById('correct-guess');
            const cardDisplay = document.getElementById('card-display');
            
            if (correctGuessBtn) {
                correctGuessBtn.addEventListener('click', () => {
                    cardDisplay.style.animation = 'none';
                    setTimeout(() => {
                        cardDisplay.style.animation = 'cardSuccess 0.5s ease';
                    }, 10);
                });
            }
            
            // Style updates for interactive elements
            const allButtons = document.querySelectorAll('button');
            allButtons.forEach(button => {
                button.addEventListener('mousedown', () => {
                    button.style.transform = 'translateY(2px)';
                });
                
                button.addEventListener('mouseup', () => {
                    if (!button.disabled) {
                        button.style.transform = '';
                    }
                });
                
                button.addEventListener('mouseleave', () => {
                    if (!button.disabled) {
                        button.style.transform = '';
                    }
                });
            });
        });

        // Add this to your style section to support the card animation
        const styleElement = document.createElement('style');
        styleElement.textContent = `
        @keyframes cardSuccess {
            0% { transform: scale(1); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08); }
            50% { transform: scale(1.02); box-shadow: 0 15px 30px rgba(99, 102, 241, 0.3); }
            100% { transform: scale(1); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08); }
        }
        `;
        document.head.appendChild(styleElement);
    </script>
</body>
</html>